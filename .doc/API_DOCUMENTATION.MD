# VolleyPass API - Documentaci√≥n Completa para Desarrollo M√≥vil

> **Versi√≥n:** 1.0.0
> **√öltima actualizaci√≥n:** Diciembre 26, 2024
> **Base URL:** `https://volleypass.test/api/v1`
> **Autenticaci√≥n:** Laravel Sanctum (Bearer Tokens)

---

## üìã Tabla de Contenidos

1. [Informaci√≥n General](#informaci√≥n-general)
2. [Autenticaci√≥n](#autenticaci√≥n)
3. [Endpoints P√∫blicos](#endpoints-p√∫blicos)
4. [Endpoints Autenticados](#endpoints-autenticados)
5. [Sistema de Verificaci√≥n QR](#sistema-de-verificaci√≥n-qr)
6. [Gesti√≥n de Partidos en Vivo](#gesti√≥n-de-partidos-en-vivo)
7. [Sistema de Sanciones](#sistema-de-sanciones)
8. [Gesti√≥n de Categor√≠as de Jugadores](#gesti√≥n-de-categor√≠as-de-jugadores)
9. [Reportes y Administraci√≥n](#reportes-y-administraci√≥n)
10. [Manejo de Errores](#manejo-de-errores)
11. [Formatos y Convenciones](#formatos-y-convenciones)
12. [Gu√≠a de Implementaci√≥n](#gu√≠a-de-implementaci√≥n)

---

## üì± Informaci√≥n General

### Caracter√≠sticas del Sistema

VolleyPass es un sistema integral de gesti√≥n de ligas de voleibol que incluye:

- ‚úÖ **Autenticaci√≥n basada en roles** con Sanctum
- ‚úÖ **Verificaci√≥n QR de carnets** de jugadores en tiempo real
- ‚úÖ **Gesti√≥n de partidos en vivo** con marcadores y rotaciones
- ‚úÖ **Sistema de sanciones** para jugadores
- ‚úÖ **Torneos p√∫blicos** con tablas de posiciones
- ‚úÖ **Sincronizaci√≥n offline** para verificaciones
- ‚úÖ **Broadcasting en tiempo real** para partidos

### Stack Tecnol√≥gico

- **Backend:** Laravel 12.24.0
- **PHP:** 8.4.16
- **Base de datos:** MySQL
- **Autenticaci√≥n:** Laravel Sanctum
- **Broadcasting:** Pusher/Socket.IO compatible
- **Cache:** Redis (opcional)

### Roles de Usuario

| Rol | Descripci√≥n | Abilities |
|-----|-------------|-----------|
| `SuperAdmin` | Administrador del sistema | `*` (todos) |
| `LeagueAdmin` | Administrador de liga | `verify`, `view:stats`, `manage:events` |
| `Verifier` | Verificador de carnets | `verify:qr`, `verify:batch` |
| `Referee` | √Årbitro de partidos | `manage:matches`, `add:sanctions` |
| `Coach` | Entrenador | `view:team`, `view:players` |
| `ClubAdmin` | Administrador de club | `manage:club` |
| `Player` | Jugador | `view:profile` |

---

## üîê Autenticaci√≥n

### Configuraci√≥n de Sanctum

```json
{
  "token_expiration": "30 days",
  "prefix": "Bearer",
  "stateful_domains": ["volleypass.test"],
  "guard": "sanctum"
}
```

### 1. Login

Obtiene un token de acceso para autenticar futuras peticiones.

**Endpoint:** `POST /auth/login`
**Auth:** No requerida
**Rate Limit:** 5 intentos por 300 segundos (por IP)

#### Request

```json
{
  "email": "verificador@volleypass.com",
  "password": "password123",
  "device_name": "iPhone 15 Pro"
}
```

**Validaci√≥n:**
- `email`: requerido, string, formato email v√°lido sin acentos
- `password`: requerido, string
- `device_name`: requerido, string (identifica el dispositivo)

#### Response Exitoso (200 OK)

```json
{
  "token": "1|abcdefghijklmnopqrstuvwxyz123456",
  "token_type": "Bearer",
  "expires_in": 2592000,
  "user": {
    "id": 1,
    "name": "Juan P√©rez",
    "email": "verificador@volleypass.com",
    "roles": ["Verifier"],
    "abilities": ["verify:qr", "verify:batch", "view:own-stats"],
    "profile": {
      "avatar_url": null,
      "phone": "+57 300 123 4567"
    }
  }
}
```

#### Errores

**401 Unauthorized** - Credenciales inv√°lidas
```json
{
  "error": "Credenciales inv√°lidas"
}
```

**429 Too Many Requests** - Rate limit excedido
```json
{
  "error": "Demasiados intentos de login. Intente en 300 segundos."
}
```

**422 Validation Error**
```json
{
  "message": "The given data was invalid.",
  "errors": {
    "email": ["El email es requerido"],
    "password": ["La contrase√±a es requerida"]
  }
}
```

---

### 2. Verificar Email

Verifica si un email existe y tiene rol de verificador.

**Endpoint:** `POST /auth/check-email`
**Auth:** No requerida

#### Request

```json
{
  "email": "verificador@volleypass.com"
}
```

#### Response

```json
{
  "exists": true
}
```

---

### 3. Obtener Usuario Actual

**Endpoint:** `GET /auth/user`
**Auth:** Requerida (Sanctum)

#### Headers

```
Authorization: Bearer {token}
Accept: application/json
```

#### Response (200 OK)

```json
{
  "user": {
    "id": 1,
    "name": "Juan P√©rez",
    "email": "verificador@volleypass.com",
    "roles": ["Verifier"],
    "abilities": ["verify:qr", "verify:batch"],
    "profile": {
      "avatar_url": null,
      "phone": "+57 300 123 4567"
    }
  },
  "token_info": {
    "name": "iPhone 15 Pro",
    "abilities": ["verify:qr"],
    "created_at": "2024-12-26T10:30:00Z",
    "expires_at": "2025-01-25T10:30:00Z"
  }
}
```

---

### 4. Logout (Dispositivo Actual)

Revoca el token actual del dispositivo.

**Endpoint:** `POST /auth/logout`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "message": "Sesi√≥n cerrada exitosamente"
}
```

---

### 5. Logout (Todos los Dispositivos)

Revoca todos los tokens del usuario.

**Endpoint:** `POST /auth/logout-all`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "message": "Sesi√≥n cerrada en todos los dispositivos (3 tokens revocados)"
}
```

---

### 6. Listar Tokens Activos

**Endpoint:** `GET /auth/tokens`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "tokens": [
    {
      "id": 1,
      "name": "iPhone 15 Pro",
      "abilities": ["verify:qr"],
      "created_at": "2024-12-26T10:30:00Z",
      "expires_at": "2025-01-25T10:30:00Z",
      "last_used_at": "2024-12-26T15:45:00Z",
      "is_current": true
    },
    {
      "id": 2,
      "name": "iPad Pro",
      "abilities": ["verify:qr"],
      "created_at": "2024-12-20T08:00:00Z",
      "expires_at": "2025-01-19T08:00:00Z",
      "last_used_at": "2024-12-25T12:00:00Z",
      "is_current": false
    }
  ],
  "total": 2
}
```

---

### 7. Revocar Token Espec√≠fico

**Endpoint:** `DELETE /auth/tokens/{tokenId}`
**Auth:** Requerida

#### Request

```json
{
  "token_id": 2
}
```

#### Response (200 OK)

```json
{
  "message": "Token 'iPad Pro' revocado exitosamente"
}
```

---

## üåê Endpoints P√∫blicos

### Health Check

Verifica el estado del API.

**Endpoint:** `GET /health`
**Auth:** No requerida

#### Response (200 OK)

```json
{
  "status": "ok",
  "timestamp": "2024-12-26T15:45:00Z",
  "version": "1.0.0",
  "environment": "production"
}
```

---

### Estado de Jugador (Por N√∫mero de Carnet)

**Endpoint:** `GET /public/player-status/{card_number}`
**Auth:** No requerida

#### Ejemplo

```
GET /public/player-status/VP2024001
```

#### Response (200 OK)

```json
{
  "player_name": "Juan P√©rez",
  "position": "L√≠bero",
  "category": "Senior",
  "card_status": "Activo",
  "is_active": true
}
```

#### Error (404)

```json
{
  "error": "Carnet no encontrado"
}
```

---

### Estad√≠sticas de Liga

**Endpoint:** `GET /public/league-stats`
**Auth:** No requerida

#### Response (200 OK)

```json
{
  "total_players": 450,
  "active_cards": 420,
  "verifications_today": 125,
  "clubs_registered": 15
}
```

---

### Torneos P√∫blicos

#### Listar Torneos

**Endpoint:** `GET /public/tournaments`
**Auth:** No requerida
**Paginaci√≥n:** 20 por p√°gina

##### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `status` | string | Filtrar por estado (scheduled, in_progress, finished) |
| `type` | string | Filtrar por tipo (championship, league, friendly) |
| `category` | string | Filtrar por categor√≠a (senior, junior, sub_17) |
| `gender` | string | Filtrar por g√©nero (male, female, mixed) |
| `page` | integer | N√∫mero de p√°gina (default: 1) |

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "current_page": 1,
    "data": [
      {
        "id": 1,
        "name": "Campeonato Nacional 2024",
        "slug": "campeonato-nacional-2024",
        "description": "Torneo anual de voleibol",
        "type": "championship",
        "format": "groups",
        "category": "senior",
        "gender": "female",
        "status": "in_progress",
        "start_date": "2024-11-01",
        "end_date": "2024-12-31",
        "venue": "Estadio Nacional",
        "max_teams": 16,
        "total_teams": 16,
        "team_count": 16,
        "is_registration_open": false,
        "logo_url": "https://volleypass.test/storage/tournaments/logo.png"
      }
    ],
    "per_page": 20,
    "total": 5,
    "last_page": 1,
    "from": 1,
    "to": 5
  }
}
```

---

#### Obtener Torneo por ID

**Endpoint:** `GET /public/tournaments/{id}`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Campeonato Nacional 2024",
    "slug": "campeonato-nacional-2024",
    "type": "championship",
    "status": "in_progress",
    "start_date": "2024-11-01",
    "end_date": "2024-12-31",
    "league": {
      "id": 1,
      "name": "Liga Nacional de Voleibol",
      "logo_url": "https://volleypass.test/storage/leagues/logo.png"
    },
    "teams": [
      {
        "id": 1,
        "name": "√Åguilas FC",
        "logo": "https://volleypass.test/storage/teams/logo1.png",
        "club": "Club Deportivo ABC"
      }
    ],
    "matches": [
      {
        "id": 1,
        "home_team": "√Åguilas FC",
        "away_team": "Tigres Unidos",
        "scheduled_at": "2024-12-27T10:00:00Z",
        "status": "scheduled",
        "home_score": null,
        "away_score": null,
        "venue": "Estadio Nacional"
      }
    ],
    "statistics": {
      "total_teams": 16,
      "total_matches": 120,
      "completed_matches": 85,
      "pending_matches": 35,
      "in_progress_matches": 0
    }
  }
}
```

---

#### Tabla de Posiciones del Torneo

**Endpoint:** `GET /public/tournaments/{id}/standings`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "tournament": {
      "id": 1,
      "name": "Campeonato Nacional 2024"
    },
    "standings": [
      {
        "position": 1,
        "team_id": 1,
        "team_name": "√Åguilas FC",
        "team_logo": "https://volleypass.test/storage/teams/logo1.png",
        "matches_played": 10,
        "wins": 9,
        "losses": 1,
        "points": 27,
        "sets_for": 28,
        "sets_against": 5,
        "set_difference": 23,
        "points_for": 750,
        "points_against": 620
      }
    ],
    "updated_at": "2024-12-26T15:45:00Z"
  }
}
```

---

#### Tabla de Posiciones por Grupo

**Endpoint:** `GET /public/tournaments/{id}/groups/{groupId}/standings`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "tournament": {
      "id": 1,
      "name": "Campeonato Nacional 2024"
    },
    "group": {
      "id": 1,
      "name": "Grupo A"
    },
    "standings": [
      {
        "position": 1,
        "team_id": 1,
        "team_name": "√Åguilas FC",
        "matches_played": 5,
        "wins": 5,
        "losses": 0,
        "points": 15
      }
    ]
  }
}
```

---

### Partidos P√∫blicos

#### Listar Partidos Programados

**Endpoint:** `GET /public/matches/scheduled`
**Auth:** No requerida
**Paginaci√≥n:** 20 por p√°gina

##### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `tournament_id` | integer | Filtrar por torneo |
| `team_id` | integer | Filtrar por equipo |
| `date` | date (YYYY-MM-DD) | Filtrar por fecha |
| `page` | integer | N√∫mero de p√°gina |

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "current_page": 1,
    "data": [
      {
        "id": 1,
        "tournament_id": 1,
        "tournament_name": "Campeonato Nacional 2024",
        "home_team": {
          "id": 1,
          "name": "√Åguilas FC",
          "logo": "https://volleypass.test/storage/teams/logo1.png"
        },
        "away_team": {
          "id": 2,
          "name": "Tigres Unidos",
          "logo": "https://volleypass.test/storage/teams/logo2.png"
        },
        "scheduled_at": "2024-12-27T10:00:00Z",
        "status": "scheduled",
        "venue": "Estadio Nacional",
        "round_number": 1,
        "match_number": 1
      }
    ],
    "per_page": 20,
    "total": 35,
    "last_page": 2
  }
}
```

---

#### Listar Partidos En Vivo

**Endpoint:** `GET /public/matches/live`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tournament_id": 1,
      "tournament_name": "Campeonato Nacional 2024",
      "home_team": {
        "id": 1,
        "name": "√Åguilas FC",
        "logo": "https://volleypass.test/storage/teams/logo1.png"
      },
      "away_team": {
        "id": 2,
        "name": "Tigres Unidos",
        "logo": "https://volleypass.test/storage/teams/logo2.png"
      },
      "status": "in_progress",
      "home_score": 1,
      "away_score": 0,
      "current_set": 1,
      "sets": [
        {
          "set_number": 1,
          "home_score": 15,
          "away_score": 12,
          "status": "in_progress"
        }
      ],
      "live_stats": {
        "duration_minutes": 25,
        "sets_played": 1,
        "current_set_number": 1,
        "home_sets_won": 0,
        "away_sets_won": 0
      },
      "started_at": "2024-12-26T15:00:00Z"
    }
  ]
}
```

---

#### Obtener Detalles de Partido

**Endpoint:** `GET /public/matches/{id}`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "id": 1,
    "tournament_id": 1,
    "tournament": {
      "id": 1,
      "name": "Campeonato Nacional 2024"
    },
    "home_team": {
      "id": 1,
      "name": "√Åguilas FC",
      "logo": "https://volleypass.test/storage/teams/logo1.png",
      "club": "Club Deportivo ABC"
    },
    "away_team": {
      "id": 2,
      "name": "Tigres Unidos",
      "logo": "https://volleypass.test/storage/teams/logo2.png",
      "club": "Club Deportivo XYZ"
    },
    "status": "finished",
    "home_score": 2,
    "away_score": 1,
    "scheduled_at": "2024-12-27T10:00:00Z",
    "started_at": "2024-12-27T10:05:00Z",
    "finished_at": "2024-12-27T11:25:00Z",
    "venue": "Estadio Nacional",
    "sets": [
      {
        "set_number": 1,
        "home_score": 25,
        "away_score": 22,
        "status": "finished",
        "duration_minutes": 28
      },
      {
        "set_number": 2,
        "home_score": 20,
        "away_score": 25,
        "status": "finished",
        "duration_minutes": 25
      },
      {
        "set_number": 3,
        "home_score": 25,
        "away_score": 18,
        "status": "finished",
        "duration_minutes": 27
      }
    ],
    "statistics": {
      "duration_minutes": 80,
      "sets_played": 3,
      "home_sets_won": 2,
      "away_sets_won": 1,
      "total_events": 145,
      "points_by_set": [
        {"set": 1, "home": 25, "away": 22},
        {"set": 2, "home": 20, "away": 25},
        {"set": 3, "home": 25, "away": 18}
      ]
    }
  }
}
```

---

#### Obtener Jugadores de un Partido

**Endpoint:** `GET /public/matches/{id}/players`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match_id": 1,
    "home_team": {
      "id": 1,
      "name": "√Åguilas FC",
      "players": [
        {
          "id": 1,
          "name": "Juan P√©rez",
          "position": "Setter",
          "jersey_number": 1,
          "is_on_court": true,
          "is_captain": true,
          "photo_url": "https://volleypass.test/storage/players/photo1.jpg"
        },
        {
          "id": 2,
          "name": "Mar√≠a Gonz√°lez",
          "position": "Libero",
          "jersey_number": 5,
          "is_on_court": true,
          "is_captain": false,
          "photo_url": "https://volleypass.test/storage/players/photo2.jpg"
        }
      ]
    },
    "away_team": {
      "id": 2,
      "name": "Tigres Unidos",
      "players": [...]
    }
  }
}
```

---

#### Obtener Jugadores de un Equipo en Partido

**Endpoint:** `GET /public/matches/{id}/teams/{teamId}/players`
**Auth:** No requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match_id": 1,
    "team_id": 1,
    "team_name": "√Åguilas FC",
    "players": [
      {
        "id": 1,
        "name": "Juan P√©rez",
        "position": "Setter",
        "jersey_number": 1,
        "height": 1.85,
        "is_on_court": true,
        "is_captain": true
      }
    ]
  }
}
```

---

## üîí Endpoints Autenticados

### Gesti√≥n de Perfil de Usuario

#### Obtener Perfil Propio

**Endpoint:** `GET /users/profile`
**Auth:** Requerida

##### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Juan P√©rez",
    "email": "juan@example.com",
    "first_name": "Juan",
    "last_name": "P√©rez",
    "phone": "+57 300 123 4567",
    "birth_date": "1990-05-15",
    "gender": "male",
    "address": "Calle 123 #45-67",
    "roles": ["Player"],
    "user_type": "player",
    "profile": {
      "nickname": "Juancho",
      "bio": "Jugador de voleibol desde 2010",
      "avatar_url": null,
      "emergency_contact_name": "Mar√≠a P√©rez",
      "emergency_contact_phone": "+57 300 987 6543",
      "emergency_contact_relationship": "Hermana",
      "blood_type": "O+",
      "allergies": "Ninguna",
      "medical_conditions": "Ninguna",
      "t_shirt_size": "L",
      "social_media": {
        "instagram": "@juancho_volley",
        "facebook": "juan.perez",
        "twitter": "@juancho"
      }
    },
    "player_info": {
      "position": "Libero",
      "jersey_number": 10,
      "height": 1.75,
      "weight": 70.5,
      "current_club": "Club Deportivo ABC",
      "category": "Senior",
      "license_number": "VP2024001",
      "is_active": true
    },
    "location": {
      "city": "Bogot√°",
      "department": "Cundinamarca",
      "country": "Colombia"
    }
  }
}
```

---

#### Actualizar Perfil Propio

**Endpoint:** `PUT /users/profile`
**Auth:** Requerida

##### Request

```json
{
  "first_name": "Juan Carlos",
  "last_name": "P√©rez Garc√≠a",
  "phone": "+57 301 234 5678",
  "address": "Calle 456 #78-90",
  "nickname": "JC",
  "bio": "Jugador profesional de voleibol",
  "emergency_contact_name": "Mar√≠a P√©rez",
  "emergency_contact_phone": "+57 300 987 6543",
  "emergency_contact_relationship": "Hermana",
  "blood_type": "O+",
  "allergies": "Polen",
  "medical_conditions": "Ninguna",
  "t_shirt_size": "XL",
  "social_media": {
    "instagram": "@jc_volley",
    "facebook": "juancarlos.perez"
  }
}
```

##### Validaci√≥n

- `first_name`: opcional, string, max 100 caracteres
- `last_name`: opcional, string, max 100 caracteres
- `phone`: opcional, string, max 20 caracteres
- `address`: opcional, string, max 255 caracteres
- `nickname`: opcional, string, max 50 caracteres
- `bio`: opcional, string, max 500 caracteres
- `emergency_contact_name`: opcional, string, max 100 caracteres
- `emergency_contact_phone`: opcional, string, max 20 caracteres
- `emergency_contact_relationship`: opcional, string, max 50 caracteres
- `blood_type`: opcional, enum (A+, A-, B+, B-, AB+, AB-, O+, O-)
- `allergies`: opcional, string, max 500 caracteres
- `medical_conditions`: opcional, string, max 500 caracteres
- `t_shirt_size`: opcional, enum (XS, S, M, L, XL, XXL)
- `social_media`: opcional, objeto

##### Response (200 OK)

```json
{
  "success": true,
  "message": "Perfil actualizado exitosamente",
  "data": {
    "id": 1,
    "name": "Juan Carlos P√©rez Garc√≠a",
    ...
  }
}
```

---

#### Obtener Perfil P√∫blico de Usuario

**Endpoint:** `GET /users/{userId}/profile`
**Auth:** Requerida

##### Response (200 OK)

Retorna informaci√≥n p√∫blica limitada del usuario:

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Juan P√©rez",
    "first_name": "Juan",
    "last_name": "P√©rez",
    "user_type": "player",
    "profile": {
      "nickname": "Juancho",
      "bio": "Jugador de voleibol desde 2010",
      "avatar_url": null
    },
    "location": {
      "city": "Bogot√°",
      "department": "Cundinamarca",
      "country": "Colombia"
    },
    "player_info": {
      "position": "Libero",
      "jersey_number": 10,
      "current_club": "Club Deportivo ABC"
    }
  }
}
```

**Nota:** Los datos sensibles como email, tel√©fono, contacto de emergencia NO se exponen.

---

## üîç Sistema de Verificaci√≥n QR

### Verificaci√≥n de Carnet por QR (P√∫blico)

**Endpoint:** `POST /verify-qr`
**Auth:** No requerida
**Uso:** Verificadores externos con `scanner_id` v√°lido

#### Request

```json
{
  "qr_code": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
  "verification_token": "e5f6789012345678901234567890123456789012345678901234567890123456",
  "scanner_id": 5,
  "event_data": {
    "event_type": "match",
    "location": "Estadio Nacional",
    "match_id": 10
  },
  "location": {
    "latitude": 4.6097,
    "longitude": -74.0817
  },
  "device_info": {
    "model": "iPhone 15 Pro",
    "os": "iOS 17.2"
  },
  "notes": "Verificaci√≥n pre-partido"
}
```

#### Validaci√≥n

- `qr_code`: **requerido**, string, exactamente 64 caracteres hexadecimales (SHA-256)
- `verification_token`: opcional, string, 64 caracteres hexadecimales
- `scanner_id`: **requerido**, integer, debe existir en `users.id`
- `event_data.event_type`: opcional, enum (match, tournament, training)
- `event_data.location`: opcional, string, max 200 caracteres
- `event_data.match_id`: opcional, integer, debe existir en `match_verifications.id`
- `location.latitude`: opcional, n√∫mero entre -90 y 90
- `location.longitude`: opcional, n√∫mero entre -180 y 180
- `device_info`: opcional, objeto
- `notes`: opcional, string, max 500 caracteres

#### Response Exitoso (200 OK)

```json
{
  "status": "success",
  "message": "Carnet v√°lido",
  "can_play": true,
  "response_time_ms": 150,
  "player_info": {
    "id": 1,
    "name": "Juan P√©rez",
    "card_number": "VP2024001",
    "club": "Club Deportivo ABC",
    "position": "Libero",
    "category": "Senior",
    "photo_url": "https://volleypass.test/storage/players/photo1.jpg",
    "birth_date": "1990-05-15",
    "age": 34,
    "gender": "male",
    "blood_type": "O+",
    "emergency_contact": "+57 300 987 6543"
  },
  "verification_id": 1234,
  "verified_at": "2024-12-26T15:45:00Z"
}
```

#### Response con Advertencia (200 OK)

```json
{
  "status": "warning",
  "message": "Carnet v√°lido pero el jugador tiene sanciones activas",
  "can_play": false,
  "response_time_ms": 145,
  "player_info": {
    "name": "Juan P√©rez",
    "card_number": "VP2024001",
    "club": "Club Deportivo ABC"
  },
  "warnings": [
    {
      "type": "sanction",
      "message": "Jugador tiene sanci√≥n activa por mala conducta",
      "details": {
        "sanction_id": 10,
        "type": "suspension",
        "matches_remaining": 2
      }
    }
  ]
}
```

#### Response con Error (400 Bad Request)

```json
{
  "status": "invalid",
  "message": "Carnet suspendido",
  "can_play": false,
  "error_code": "CARD_SUSPENDED",
  "details": {
    "reason": "Falta de pago",
    "suspended_at": "2024-12-01T00:00:00Z"
  }
}
```

#### C√≥digos de Error

| C√≥digo | Descripci√≥n |
|--------|-------------|
| `CARD_NOT_FOUND` | QR code no encontrado en el sistema |
| `CARD_EXPIRED` | Carnet expirado |
| `CARD_SUSPENDED` | Carnet suspendido |
| `CARD_INACTIVE` | Carnet inactivo |
| `PLAYER_SANCTIONED` | Jugador tiene sanciones activas |
| `MEDICAL_EXPIRED` | Certificado m√©dico expirado |
| `SYSTEM_ERROR` | Error interno del servidor |

---

### Obtener Informaci√≥n de QR (Sin Verificaci√≥n)

**Endpoint:** `POST /qr-info`
**Auth:** No requerida
**Uso:** Solo consulta, no genera registro de verificaci√≥n

#### Request

```json
{
  "qr_code": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd"
}
```

#### Response (200 OK)

```json
{
  "status": "success",
  "data": {
    "card_number": "VP2024001",
    "player_name": "Juan P√©rez",
    "club_name": "Club Deportivo ABC",
    "position": "Libero",
    "status": "Activo",
    "photo_url": "https://volleypass.test/storage/players/photo1.jpg",
    "valid_until": "2024-12-31",
    "issued_date": "2024-01-01"
  }
}
```

---

### Verificaci√≥n por Token de Carnet

**Endpoint:** `GET /card/verify/{token}`
**Auth:** No requerida

#### Ejemplo

```
GET /card/verify/abc123def456
```

#### Response (200 OK)

```json
{
  "valid": true,
  "message": "Carnet v√°lido",
  "data": {
    "player_name": "Juan P√©rez",
    "card_number": "VP2024001",
    "league": "Liga Nacional",
    "club": "Club ABC",
    "status": "active",
    "can_play": true,
    "expires_at": "2024-12-31",
    "photo_url": "https://volleypass.test/storage/players/photo1.jpg"
  },
  "verified_at": "2024-12-26T15:45:00Z"
}
```

---

### Verificaci√≥n por N√∫mero de Carnet

**Endpoint:** `GET /card/number/{cardNumber}`
**Auth:** No requerida

#### Ejemplo

```
GET /card/number/VP2024001
```

#### Response

Misma estructura que `/card/verify/{token}`

---

### Detalles de Carnet (Autenticado)

**Endpoint:** `GET /card/details/{token}`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "valid": true,
  "card": {
    "card_id": 1,
    "card_number": "VP2024001",
    "player_id": 1,
    "player_name": "Juan P√©rez",
    "status": "active",
    "issued_at": "2024-01-01T00:00:00Z",
    "expires_at": "2024-12-31T23:59:59Z",
    "qr_code_url": "https://volleypass.test/qr/VP2024001.png"
  },
  "verification_stats": {
    "total_scans": 25,
    "last_scan": "2024-12-26T15:45:00Z",
    "scans_this_month": 8,
    "unique_locations": 5
  }
}
```

---

### Estad√≠sticas de Carnets

**Endpoint:** `GET /card/stats`
**Auth:** Requerida
**Query Params:** `days` (default: 30)

#### Ejemplo

```
GET /card/stats?days=7
```

#### Response (200 OK)

```json
{
  "verification_stats": {
    "total_verifications": 150,
    "successful_verifications": 148,
    "failed_verifications": 2,
    "average_response_time": 145
  },
  "period_days": 7,
  "date_from": "2024-12-19",
  "date_to": "2024-12-26",
  "generated_at": "2024-12-26T15:45:00Z"
}
```

---

### Verificaci√≥n Batch (M√∫ltiples QR)

**Endpoint:** `POST /verify-batch`
**Auth:** Requerida
**Roles:** Verifier, LeagueAdmin, SuperAdmin
**L√≠mite:** M√°ximo 50 QR codes por request

#### Request

```json
{
  "qr_codes": [
    {
      "qr_code": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
      "verification_token": "e5f6789012345678901234567890123456789012345678901234567890123456"
    },
    {
      "qr_code": "b2c3d4e5f6789012345678901234567890123456789012345678901234abcdef",
      "verification_token": null
    }
  ],
  "scanner_id": 5,
  "event_data": {
    "event_type": "match",
    "location": "Estadio Nacional"
  }
}
```

#### Validaci√≥n

- `qr_codes`: **requerido**, array, min 1, max 50 elementos
- `qr_codes.*.qr_code`: **requerido**, string, 64 caracteres hex
- `qr_codes.*.verification_token`: opcional, string, 64 caracteres hex
- `scanner_id`: **requerido**, integer
- `event_data`: opcional, objeto

#### Response (200 OK)

```json
{
  "status": "success",
  "summary": {
    "total": 50,
    "approved": 48,
    "rejected": 2,
    "warnings": 3
  },
  "results": [
    {
      "qr_code": "a1b2c3d4...",
      "status": "success",
      "message": "Carnet v√°lido",
      "can_play": true,
      "player_info": {
        "name": "Juan P√©rez",
        "card_number": "VP2024001"
      }
    },
    {
      "qr_code": "b2c3d4e5...",
      "status": "invalid",
      "message": "Carnet suspendido",
      "can_play": false,
      "error_code": "CARD_SUSPENDED"
    }
  ],
  "processing_time_ms": 450
}
```

---

### Dashboard de Verificaci√≥n

**Endpoint:** `GET /stats/dashboard`
**Auth:** Requerida
**Roles:** Verifier, LeagueAdmin, SuperAdmin
**Query Params:** `days` (default: 30)

#### Response (200 OK)

```json
{
  "status": "success",
  "data": {
    "total_verifications": 1250,
    "successful_verifications": 1200,
    "failed_verifications": 50,
    "average_response_time": 142,
    "verifications_by_day": [
      {
        "date": "2024-12-26",
        "total": 125,
        "successful": 120,
        "failed": 5
      }
    ],
    "user_stats": {
      "total_scans": 350,
      "successful_scans": 340,
      "avg_response_time": 138,
      "rank": 3,
      "total_verifiers": 12
    },
    "top_verifiers": [
      {
        "id": 5,
        "name": "Carlos Mart√≠nez",
        "total_scans": 450,
        "avg_response_time": 135
      }
    ]
  }
}
```

---

## üì± Mobile App - Verificaci√≥n Avanzada

### Verificar QR (Mobile App)

**Endpoint:** `POST /mobile/verify`
**Auth:** Requerida
**Uso:** Para apps m√≥viles con sesi√≥n activa

#### Request

```json
{
  "qr_code": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
  "match_session_id": 10,
  "device_info": "iPhone 15 Pro - iOS 17.2",
  "location": {
    "latitude": 4.6097,
    "longitude": -74.0817
  }
}
```

#### Validaci√≥n

- `qr_code`: **requerido**, string, 64 caracteres hex
- `match_session_id`: opcional, integer, debe existir y pertenecer al usuario
- `device_info`: opcional, string
- `location`: opcional, objeto con lat/lng

#### Response (200 OK)

```json
{
  "success": true,
  "verification": {
    "id": 1,
    "result": "eligible",
    "restriction_reason": null,
    "verified_at": "2024-12-26T15:45:00Z",
    "session_id": 10
  },
  "player": {
    "id": 1,
    "card_number": "VP2024001",
    "full_name": "Juan P√©rez",
    "photo_url": "https://volleypass.test/storage/players/photo1.jpg",
    "birth_date": "1990-05-15",
    "age": 34,
    "gender": "male",
    "position": "Libero",
    "category": "Senior",
    "club_name": "Club ABC",
    "is_active": true,
    "license_number": "VP2024001",
    "blood_type": "O+",
    "emergency_contact": "+57 300 987 6543"
  }
}
```

---

### Historial de Verificaciones

**Endpoint:** `GET /mobile/verifications`
**Auth:** Requerida
**Paginaci√≥n:** 20 por p√°gina

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `result` | string | Filtrar por resultado (eligible, restricted, not_eligible) |
| `date` | date (YYYY-MM-DD) | Filtrar por fecha |
| `match_session_id` | integer | Filtrar por sesi√≥n |
| `per_page` | integer | Items por p√°gina (max: 100) |
| `page` | integer | N√∫mero de p√°gina |

#### Response (200 OK)

```json
{
  "success": true,
  "verifications": [
    {
      "id": 1,
      "player_name": "Juan P√©rez",
      "player_photo": "https://volleypass.test/storage/players/photo1.jpg",
      "card_number": "VP2024001",
      "result": "eligible",
      "restriction_reason": null,
      "verified_at": "2024-12-26T15:45:00Z",
      "is_offline": false,
      "match": {
        "id": 1,
        "home_team": "√Åguilas FC",
        "away_team": "Tigres Unidos",
        "scheduled_at": "2024-12-26T15:00:00Z"
      }
    },
    {
      "id": 2,
      "player_name": "Mar√≠a Gonz√°lez",
      "player_photo": "https://volleypass.test/storage/players/photo2.jpg",
      "card_number": "VP2024002",
      "result": "restricted",
      "restriction_reason": "Jugador tiene sanci√≥n activa",
      "verified_at": "2024-12-26T15:50:00Z",
      "is_offline": false,
      "match": null
    }
  ],
  "pagination": {
    "total": 150,
    "per_page": 20,
    "current_page": 1,
    "last_page": 8,
    "from": 1,
    "to": 20
  }
}
```

---

### Sincronizar Verificaciones Offline

**Endpoint:** `POST /mobile/verifications/sync`
**Auth:** Requerida
**Uso:** Sincronizar verificaciones realizadas sin conexi√≥n

#### Request

```json
{
  "verifications": [
    {
      "qr_code": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
      "verified_at": "2024-12-26T15:30:00Z",
      "match_session_id": 10,
      "device_info": "iPhone 15 Pro"
    },
    {
      "qr_code": "b2c3d4e5f6789012345678901234567890123456789012345678901234abcdef",
      "verified_at": "2024-12-26T15:35:00Z",
      "match_session_id": 10,
      "device_info": "iPhone 15 Pro"
    }
  ]
}
```

#### Validaci√≥n

- `verifications`: **requerido**, array, max 100 elementos
- `verifications.*.qr_code`: **requerido**, string, 64 caracteres hex
- `verifications.*.verified_at`: **requerido**, datetime ISO 8601
- `verifications.*.match_session_id`: opcional, integer
- `verifications.*.device_info`: opcional, string

#### Response (200 OK)

```json
{
  "success": true,
  "synced": 10,
  "failed": 2,
  "synced_ids": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
  "errors": [
    {
      "qr_code": "invalid_qr_code",
      "error": "Invalid QR code format"
    },
    {
      "qr_code": "duplicate_qr_code",
      "error": "Verification already exists"
    }
  ],
  "processing_time_ms": 350
}
```

---

### Estad√≠sticas de Verificaciones

**Endpoint:** `GET /mobile/verifications/stats`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "success": true,
  "stats": {
    "total_verifications": 150,
    "today_verifications": 25,
    "eligible_count": 140,
    "restricted_count": 5,
    "not_eligible_count": 5,
    "offline_count": 10,
    "last_verification": "2024-12-26T15:45:00Z",
    "avg_verifications_per_day": 21.4,
    "most_active_day": "2024-12-25"
  }
}
```

---

## üéÆ Sesiones de Partido (Match Sessions)

### Listar Sesiones

**Endpoint:** `GET /mobile/sessions`
**Auth:** Requerida
**Paginaci√≥n:** 20 por p√°gina

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `status` | string | Filtrar por estado (active, paused, completed) |
| `match_id` | integer | Filtrar por partido |
| `per_page` | integer | Items por p√°gina |
| `page` | integer | N√∫mero de p√°gina |

#### Response (200 OK)

```json
{
  "success": true,
  "sessions": [
    {
      "id": 1,
      "status": "active",
      "started_at": "2024-12-26T15:00:00Z",
      "completed_at": null,
      "paused_at": null,
      "total_verifications": 20,
      "home_team_verifications": 12,
      "away_team_verifications": 8,
      "match": {
        "id": 1,
        "home_team": "√Åguilas FC",
        "away_team": "Tigres Unidos",
        "tournament": "Torneo 2024",
        "scheduled_at": "2024-12-26T15:00:00Z",
        "venue": "Estadio Nacional"
      }
    }
  ],
  "pagination": {
    "total": 50,
    "per_page": 20,
    "current_page": 1,
    "last_page": 3
  }
}
```

---

### Crear Sesi√≥n de Partido

**Endpoint:** `POST /mobile/sessions`
**Auth:** Requerida
**Restricci√≥n:** Solo una sesi√≥n activa por usuario

#### Request

```json
{
  "match_id": 1,
  "notes": {
    "location": "Cancha Principal",
    "weather": "Soleado"
  }
}
```

#### Validaci√≥n

- `match_id`: **requerido**, integer, debe existir en `volley_matches`
- `notes`: opcional, objeto JSON

#### Response (201 Created)

```json
{
  "success": true,
  "session": {
    "id": 1,
    "status": "active",
    "started_at": "2024-12-26T15:00:00Z",
    "total_verifications": 0,
    "match": {
      "id": 1,
      "home_team": "√Åguilas FC",
      "away_team": "Tigres Unidos",
      "tournament": "Torneo 2024",
      "scheduled_at": "2024-12-26T15:00:00Z"
    }
  }
}
```

#### Errores

**400 Bad Request** - Ya existe sesi√≥n activa
```json
{
  "success": false,
  "message": "Ya tienes una sesi√≥n activa. Compl√©tala primero.",
  "active_session_id": 5
}
```

---

### Obtener Sesi√≥n Activa

**Endpoint:** `GET /mobile/sessions/active`
**Auth:** Requerida

#### Response (200 OK)

Si existe sesi√≥n activa:
```json
{
  "success": true,
  "session": {
    "id": 1,
    "status": "active",
    "started_at": "2024-12-26T15:00:00Z",
    "total_verifications": 20,
    "match": {...}
  }
}
```

Si NO existe sesi√≥n activa:
```json
{
  "success": true,
  "session": null
}
```

---

### Obtener Partidos Disponibles

**Endpoint:** `GET /mobile/sessions/available-matches`
**Auth:** Requerida
**Filtro:** Partidos entre 6 horas atr√°s y 24 horas adelante

#### Response (200 OK)

```json
{
  "success": true,
  "matches": [
    {
      "id": 1,
      "home_team": "√Åguilas FC",
      "away_team": "Tigres Unidos",
      "tournament": "Torneo 2024",
      "venue": "Estadio Nacional",
      "scheduled_at": "2024-12-26T15:00:00Z",
      "status": "scheduled"
    },
    {
      "id": 2,
      "home_team": "Leones SC",
      "away_team": "Panteras FC",
      "tournament": "Torneo 2024",
      "venue": "Coliseo Municipal",
      "scheduled_at": "2024-12-26T17:00:00Z",
      "status": "scheduled"
    }
  ]
}
```

---

### Obtener Detalles de Sesi√≥n

**Endpoint:** `GET /mobile/sessions/{session}`
**Auth:** Requerida
**Autorizaci√≥n:** Solo el creador puede ver la sesi√≥n

#### Response (200 OK)

```json
{
  "success": true,
  "session": {
    "id": 1,
    "status": "active",
    "started_at": "2024-12-26T15:00:00Z",
    "completed_at": null,
    "paused_at": null,
    "total_verifications": 20,
    "home_team_verifications": 12,
    "away_team_verifications": 8,
    "notes": {
      "location": "Cancha Principal"
    },
    "match": {
      "id": 1,
      "home_team": "√Åguilas FC",
      "away_team": "Tigres Unidos",
      "scheduled_at": "2024-12-26T15:00:00Z"
    },
    "verifications": [
      {
        "id": 1,
        "player_name": "Juan P√©rez",
        "card_number": "VP2024001",
        "team": "√Åguilas FC",
        "result": "eligible",
        "verified_at": "2024-12-26T15:30:00Z"
      }
    ],
    "duration_minutes": 45
  }
}
```

---

### Actualizar Sesi√≥n (Pausar/Reanudar)

**Endpoint:** `PUT /mobile/sessions/{session}`
**Auth:** Requerida
**Autorizaci√≥n:** Solo el creador puede actualizar

#### Request

```json
{
  "action": "pause",
  "notes": {
    "reason": "Tiempo fuera"
  }
}
```

#### Validaci√≥n

- `action`: **requerido**, enum (pause, resume)
- `notes`: opcional, objeto

#### Response (200 OK)

```json
{
  "success": true,
  "session": {
    "id": 1,
    "status": "paused",
    "paused_at": "2024-12-26T16:00:00Z",
    "total_verifications": 20
  }
}
```

---

### Completar Sesi√≥n

**Endpoint:** `POST /mobile/sessions/{session}/complete`
**Auth:** Requerida
**Autorizaci√≥n:** Solo el creador puede completar

#### Request

```json
{
  "notes": {
    "final_count": 20,
    "observations": "Sin incidentes"
  }
}
```

#### Response (200 OK)

```json
{
  "success": true,
  "session": {
    "id": 1,
    "status": "completed",
    "started_at": "2024-12-26T15:00:00Z",
    "completed_at": "2024-12-26T16:30:00Z",
    "total_verifications": 20,
    "home_team_verifications": 12,
    "away_team_verifications": 8,
    "duration_minutes": 90
  }
}
```

---

### Iniciar Sesi√≥n de Escaneo (Legacy)

**Endpoint:** `POST /scanner/start-session`
**Auth:** Requerida
**Roles:** Verifier, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "event_name": "Partido Final - Torneo 2024",
  "event_type": "match",
  "location": "Estadio Nacional"
}
```

#### Validaci√≥n

- `event_name`: **requerido**, string, max 200 caracteres
- `event_type`: **requerido**, enum (match, tournament, training)
- `location`: opcional, string, max 200 caracteres

#### Response (200 OK)

```json
{
  "session_id": 1,
  "message": "Sesi√≥n iniciada"
}
```

---

### Finalizar Sesi√≥n de Escaneo (Legacy)

**Endpoint:** `POST /scanner/end-session/{sessionId}`
**Auth:** Requerida
**Autorizaci√≥n:** Solo el creador

#### Response (200 OK)

```json
{
  "message": "Sesi√≥n finalizada",
  "duration_minutes": 45
}
```

---

## üèê Gesti√≥n de Partidos en Vivo

### Obtener Partidos en Vivo

**Endpoint:** `GET /matches/live`
**Auth:** No requerida

#### Response (200 OK)

```json
[
  {
    "id": 1,
    "home_team_id": 1,
    "away_team_id": 2,
    "home_score": 1,
    "away_score": 0,
    "current_set": 1,
    "status": "in_progress",
    "tournament_id": 1,
    "started_at": "2024-12-26T15:00:00Z"
  }
]
```

---

### Datos en Tiempo Real de Partido

**Endpoint:** `GET /matches/{matchId}/realtime`
**Auth:** No requerida

#### Response (200 OK)

```json
{
  "match_id": 1,
  "status": "in_progress",
  "current_set": 1,
  "home_score": 1,
  "away_score": 0,
  "sets": [
    {
      "set_number": 1,
      "home_score": 15,
      "away_score": 12,
      "status": "in_progress",
      "started_at": "2024-12-26T15:05:00Z"
    }
  ],
  "recent_events": [
    {
      "id": 1,
      "event_type": "point",
      "team": "home",
      "player": "Juan P√©rez",
      "timestamp": "2024-12-26T15:25:00Z"
    }
  ],
  "last_updated": "2024-12-26T15:26:00Z"
}
```

---

### Iniciar Partido

**Endpoint:** `POST /matches/{id}/start`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match": {
      "id": 1,
      "status": "in_progress",
      "started_at": "2024-12-26T15:00:00Z"
    },
    "first_set": {
      "set_number": 1,
      "status": "in_progress",
      "home_score": 0,
      "away_score": 0
    }
  },
  "message": "Partido iniciado exitosamente"
}
```

---

### Finalizar Partido

**Endpoint:** `POST /matches/{id}/finish`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match": {
      "id": 1,
      "status": "finished",
      "home_score": 3,
      "away_score": 1,
      "finished_at": "2024-12-26T16:30:00Z"
    }
  },
  "message": "Partido finalizado exitosamente"
}
```

---

### Iniciar Nuevo Set

**Endpoint:** `POST /matches/{id}/sets/start`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "set": {
      "id": 2,
      "set_number": 2,
      "status": "in_progress",
      "home_score": 0,
      "away_score": 0,
      "started_at": "2024-12-26T15:35:00Z"
    }
  },
  "message": "Set iniciado exitosamente"
}
```

---

### Finalizar Set

**Endpoint:** `POST /matches/{id}/sets/finish`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "home_score": 25,
  "away_score": 22
}
```

#### Validaci√≥n

- `home_score`: **requerido**, integer, min 0
- `away_score`: **requerido**, integer, min 0

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "set": {
      "id": 1,
      "set_number": 1,
      "status": "finished",
      "home_score": 25,
      "away_score": 22,
      "finished_at": "2024-12-26T15:32:00Z",
      "duration_minutes": 27
    }
  },
  "message": "Set finalizado exitosamente"
}
```

---

### Actualizar Marcador de Set

**Endpoint:** `POST /matches/{id}/score`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "home_score": 15,
  "away_score": 12
}
```

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "set": {
      "set_number": 1,
      "home_score": 15,
      "away_score": 12,
      "status": "in_progress"
    }
  }
}
```

---

### Actualizar Rotaci√≥n

**Endpoint:** `POST /matches/{id}/rotation`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "team": "home",
  "rotation": [1, 5, 8, 12, 15, 20]
}
```

#### Validaci√≥n

- `team`: **requerido**, enum (home, away)
- `rotation`: **requerido**, array de 6 player IDs

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "rotation": {
      "team": "home",
      "positions": [
        {"position": 1, "player_id": 1, "player_name": "Juan P√©rez"},
        {"position": 2, "player_id": 5, "player_name": "Carlos D√≠az"},
        {"position": 3, "player_id": 8, "player_name": "Luis G√≥mez"},
        {"position": 4, "player_id": 12, "player_name": "Pedro S√°nchez"},
        {"position": 5, "player_id": 15, "player_name": "Miguel Torres"},
        {"position": 6, "player_id": 20, "player_name": "Jorge Ram√≠rez"}
      ]
    }
  }
}
```

---

### Agregar Evento de Partido

**Endpoint:** `POST /matches/{id}/events`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "event_type": "point",
  "event_subtype": "spike",
  "team_id": 1,
  "player_id": 5,
  "description": "Remate ganador",
  "is_successful": true,
  "points_awarded": 1,
  "coordinates_x": 2.5,
  "coordinates_y": 8.0
}
```

#### Validaci√≥n

- `event_type`: **requerido**, string
- `event_subtype`: opcional, string
- `team_id`: **requerido**, integer, debe existir en `teams`
- `player_id`: opcional, integer, debe existir en `players`
- `description`: opcional, string, max 500 caracteres
- `is_successful`: opcional, boolean
- `points_awarded`: opcional, integer, min 0
- `coordinates_x`: opcional, n√∫mero
- `coordinates_y`: opcional, n√∫mero

#### Response (201 Created)

```json
{
  "success": true,
  "data": {
    "event": {
      "id": 1,
      "event_type": "point",
      "event_subtype": "spike",
      "team": "√Åguilas FC",
      "player": "Carlos D√≠az",
      "created_at": "2024-12-26T15:25:00Z"
    }
  }
}
```

---

### Obtener Eventos de Partido

**Endpoint:** `GET /matches/{id}/events`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `set_number` | integer | Filtrar por set |
| `event_type` | string | Filtrar por tipo de evento |

#### Response (200 OK)

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "event_type": "point",
      "event_subtype": "spike",
      "team": "√Åguilas FC",
      "player": "Carlos D√≠az",
      "set_number": 1,
      "created_at": "2024-12-26T15:25:00Z"
    }
  ]
}
```

---

### Obtener Estado de Partido

**Endpoint:** `GET /matches/{id}/status`
**Auth:** No requerida

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match": {
      "id": 1,
      "status": "in_progress",
      "home_score": 1,
      "away_score": 0,
      "current_set": 1
    },
    "sets": [
      {
        "set_number": 1,
        "status": "in_progress",
        "home_score": 15,
        "away_score": 12
      }
    ],
    "current_rotations": {
      "home": [...],
      "away": [...]
    },
    "recent_events": [...]
  }
}
```

---

## üîÑ Control de Rotaciones

### Actualizar Rotaci√≥n del Equipo

**Endpoint:** `POST /matches/{id}/rotation/update`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "team_id": 1,
  "rotation_data": {
    "positions": [
      {"position": 1, "player_id": 1},
      {"position": 2, "player_id": 5},
      {"position": 3, "player_id": 8},
      {"position": 4, "player_id": 12},
      {"position": 5, "player_id": 15},
      {"position": 6, "player_id": 20}
    ]
  },
  "set_number": 1
}
```

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "rotation": {
      "team_id": 1,
      "set_number": 1,
      "positions": [...]
    }
  }
}
```

---

### Rotar Posiciones

**Endpoint:** `POST /matches/{id}/rotation/rotate`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "team_id": 1,
  "direction": "clockwise",
  "set_number": 1
}
```

#### Validaci√≥n

- `team_id`: **requerido**, integer
- `direction`: **requerido**, enum (clockwise, counterclockwise)
- `set_number`: opcional, integer, min 1

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "rotation": {
      "team_id": 1,
      "positions": [
        {"position": 1, "player_id": 20},
        {"position": 2, "player_id": 1},
        {"position": 3, "player_id": 5},
        {"position": 4, "player_id": 8},
        {"position": 5, "player_id": 12},
        {"position": 6, "player_id": 15}
      ]
    }
  }
}
```

---

### Obtener Rotaci√≥n Actual

**Endpoint:** `GET /matches/{id}/rotation/current`
**Auth:** Requerida (opcional para p√∫blico)

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `team_id` | integer | Obtener rotaci√≥n de equipo espec√≠fico |
| `set_number` | integer | Obtener rotaci√≥n de set espec√≠fico |

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "match_id": 1,
    "set_number": 1,
    "rotations": {
      "home": {
        "team_id": 1,
        "team_name": "√Åguilas FC",
        "positions": [
          {"position": 1, "player_id": 1, "player_name": "Juan P√©rez"},
          {"position": 2, "player_id": 5, "player_name": "Carlos D√≠az"},
          {"position": 3, "player_id": 8, "player_name": "Luis G√≥mez"},
          {"position": 4, "player_id": 12, "player_name": "Pedro S√°nchez"},
          {"position": 5, "player_id": 15, "player_name": "Miguel Torres"},
          {"position": 6, "player_id": 20, "player_name": "Jorge Ram√≠rez"}
        ]
      },
      "away": {
        "team_id": 2,
        "team_name": "Tigres Unidos",
        "positions": [...]
      }
    }
  }
}
```

---

### Obtener Historial de Rotaciones

**Endpoint:** `GET /matches/{id}/rotation/history`
**Auth:** Requerida

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `team_id` | integer | Filtrar por equipo |
| `set_number` | integer | Filtrar por set |

#### Response (200 OK)

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "team_id": 1,
      "set_number": 1,
      "rotation_number": 1,
      "positions": [...],
      "created_at": "2024-12-26T15:05:00Z"
    },
    {
      "id": 2,
      "team_id": 1,
      "set_number": 1,
      "rotation_number": 2,
      "positions": [...],
      "created_at": "2024-12-26T15:12:00Z"
    }
  ]
}
```

---

### Sustituir Jugador

**Endpoint:** `POST /matches/{id}/rotation/substitute`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "team_id": 1,
  "player_out_id": 5,
  "player_in_id": 7,
  "position": "2",
  "set_number": 1
}
```

#### Validaci√≥n

- `team_id`: **requerido**, integer
- `player_out_id`: **requerido**, integer, jugador que sale
- `player_in_id`: **requerido**, integer, jugador que entra
- `position`: **requerido**, string, posici√≥n en la rotaci√≥n
- `set_number`: opcional, integer

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "substitution": {
      "player_out": "Carlos D√≠az",
      "player_in": "Roberto Ruiz",
      "position": "2",
      "timestamp": "2024-12-26T15:20:00Z"
    },
    "updated_rotation": {
      "positions": [...]
    }
  }
}
```

---

### Validar Rotaci√≥n

**Endpoint:** `POST /matches/{id}/rotation/validate`
**Auth:** Requerida

#### Request

```json
{
  "team_id": 1,
  "rotation_data": {
    "positions": [
      {"position": 1, "player_id": 1},
      {"position": 2, "player_id": 5},
      {"position": 3, "player_id": 8},
      {"position": 4, "player_id": 12},
      {"position": 5, "player_id": 15},
      {"position": 6, "player_id": 20}
    ]
  }
}
```

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "is_valid": true,
    "current_rotation": {
      "positions": [...]
    },
    "proposed_rotation": {
      "positions": [...]
    },
    "validation_message": "Datos de rotaci√≥n v√°lidos",
    "warnings": []
  }
}
```

#### Response (422 Unprocessable Entity)

```json
{
  "success": false,
  "data": {
    "is_valid": false,
    "validation_message": "Rotaci√≥n inv√°lida",
    "errors": [
      "Jugador con ID 5 no pertenece al equipo",
      "Posici√≥n duplicada: 3"
    ]
  }
}
```

---

### Obtener Posiciones Disponibles

**Endpoint:** `GET /matches/{id}/rotation/positions`
**Auth:** Requerida

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "positions": [
      {"id": 1, "name": "Colocador", "zone": 1},
      {"id": 2, "name": "Opuesto", "zone": 2},
      {"id": 3, "name": "Central", "zone": 3},
      {"id": 4, "name": "Receptor", "zone": 4},
      {"id": 5, "name": "Central", "zone": 5},
      {"id": 6, "name": "L√≠bero", "zone": 6}
    ],
    "rotation_order": ["Zona 1", "Zona 2", "Zona 3", "Zona 4", "Zona 5", "Zona 6"],
    "current_rotations": {
      "home": {
        "team_id": 1,
        "positions": [...]
      },
      "away": {
        "team_id": 2,
        "positions": [...]
      }
    }
  }
}
```

---

## ‚ö†Ô∏è Sistema de Sanciones

### Listar Sanciones

**Endpoint:** `GET /sanctions`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin
**Paginaci√≥n:** 20 por p√°gina

#### Query Parameters

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `player_id` | integer | Filtrar por jugador |
| `team_id` | integer | Filtrar por equipo |
| `tournament_id` | integer | Filtrar por torneo |
| `status` | string | Filtrar por estado (active, completed, appealed, overturned) |
| `include_inactive` | boolean | Incluir sanciones inactivas |
| `page` | integer | N√∫mero de p√°gina |

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "current_page": 1,
    "data": [
      {
        "id": 1,
        "player_id": 1,
        "player": {
          "id": 1,
          "name": "Juan P√©rez",
          "card_number": "VP2024001"
        },
        "team": {
          "id": 1,
          "name": "√Åguilas FC"
        },
        "type": "yellow_card",
        "severity": "minor",
        "reason": "Mala conducta",
        "description": "Reclamo airado al √°rbitro",
        "match_id": 1,
        "tournament_id": 1,
        "referee_id": 2,
        "referee": {
          "id": 2,
          "name": "Carlos Mart√≠nez"
        },
        "status": "active",
        "applied_at": "2024-12-26T15:45:00Z",
        "fine_amount": 0,
        "suspension_matches": 0
      }
    ],
    "per_page": 20,
    "total": 5,
    "last_page": 1
  }
}
```

---

### Crear Sanci√≥n

**Endpoint:** `POST /sanctions`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Request

```json
{
  "player_id": 1,
  "type": "yellow_card",
  "severity": "minor",
  "reason": "Mala conducta",
  "match_id": 1,
  "tournament_id": 1,
  "description": "Reclamo airado al √°rbitro durante el segundo set",
  "fine_amount": 0,
  "suspension_matches": 0,
  "suspension_days": 0
}
```

#### Validaci√≥n

- `player_id`: **requerido**, integer, debe existir en `players`
- `type`: **requerido**, enum (yellow_card, red_card, suspension, fine, warning)
- `severity`: **requerido**, enum (minor, moderate, major, severe)
- `reason`: **requerido**, string, max 500 caracteres
- `match_id`: opcional, integer, debe existir en `volley_matches`
- `tournament_id`: opcional, integer, debe existir en `tournaments`
- `description`: opcional, string, max 1000 caracteres
- `fine_amount`: opcional, n√∫mero, min 0
- `suspension_matches`: opcional, integer, min 0
- `suspension_days`: opcional, integer, min 0

#### Response (201 Created)

```json
{
  "success": true,
  "data": {
    "id": 1,
    "player": {
      "id": 1,
      "name": "Juan P√©rez"
    },
    "type": "yellow_card",
    "severity": "minor",
    "reason": "Mala conducta",
    "status": "active",
    "applied_at": "2024-12-26T15:45:00Z"
  },
  "message": "Sanci√≥n aplicada exitosamente"
}
```

---

### Obtener Detalles de Sanci√≥n

**Endpoint:** `GET /sanctions/{id}`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "id": 1,
    "player": {
      "id": 1,
      "name": "Juan P√©rez",
      "card_number": "VP2024001",
      "photo_url": "https://volleypass.test/storage/players/photo1.jpg"
    },
    "team": {
      "id": 1,
      "name": "√Åguilas FC"
    },
    "match": {
      "id": 1,
      "home_team": "√Åguilas FC",
      "away_team": "Tigres Unidos",
      "scheduled_at": "2024-12-26T15:00:00Z"
    },
    "tournament": {
      "id": 1,
      "name": "Campeonato Nacional 2024"
    },
    "type": "yellow_card",
    "severity": "minor",
    "reason": "Mala conducta",
    "description": "Reclamo airado al √°rbitro durante el segundo set",
    "status": "active",
    "applied_at": "2024-12-26T15:45:00Z",
    "referee": {
      "id": 2,
      "name": "Carlos Mart√≠nez"
    }
  }
}
```

---

### Revocar Sanci√≥n

**Endpoint:** `POST /sanctions/{id}/revoke`
**Auth:** Requerida
**Roles:** LeagueAdmin, SuperAdmin

#### Request

```json
{
  "reason": "Error en la aplicaci√≥n de la sanci√≥n"
}
```

#### Validaci√≥n

- `reason`: **requerido**, string, max 500 caracteres

#### Response (200 OK)

```json
{
  "success": true,
  "message": "Sanci√≥n revocada exitosamente",
  "data": {
    "id": 1,
    "status": "overturned",
    "revoked_at": "2024-12-26T16:00:00Z",
    "revoke_reason": "Error en la aplicaci√≥n de la sanci√≥n"
  }
}
```

---

### Apelar Sanci√≥n

**Endpoint:** `POST /sanctions/{id}/appeal`
**Auth:** Requerida

#### Request

```json
{
  "reason": "La sanci√≥n fue injusta. El jugador no tuvo mala conducta."
}
```

#### Validaci√≥n

- `reason`: **requerido**, string, max 1000 caracteres

#### Response (200 OK)

```json
{
  "success": true,
  "message": "Apelaci√≥n registrada exitosamente",
  "data": {
    "id": 1,
    "status": "appealed",
    "appealed_at": "2024-12-26T17:00:00Z",
    "appeal_reason": "La sanci√≥n fue injusta. El jugador no tuvo mala conducta."
  }
}
```

---

### Obtener Sanciones Activas de Jugador

**Endpoint:** `GET /sanctions/player/{playerId}/active`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": {
    "player_id": 1,
    "player_name": "Juan P√©rez",
    "is_eligible": false,
    "active_sanctions": [
      {
        "id": 1,
        "type": "suspension",
        "severity": "major",
        "reason": "Agresi√≥n f√≠sica",
        "matches_remaining": 2,
        "applied_at": "2024-12-20T15:00:00Z"
      }
    ],
    "restrictions": [
      "No puede participar en los pr√≥ximos 2 partidos",
      "Multa de $100.000 pendiente de pago"
    ]
  }
}
```

---

### Obtener Sanciones de un Partido

**Endpoint:** `GET /sanctions/match/{matchId}`
**Auth:** Requerida
**Roles:** Referee, LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "player": {
        "id": 1,
        "name": "Juan P√©rez",
        "team": "√Åguilas FC"
      },
      "type": "yellow_card",
      "severity": "minor",
      "reason": "Mala conducta",
      "applied_at": "2024-12-26T15:45:00Z"
    },
    {
      "id": 2,
      "player": {
        "id": 5,
        "name": "Carlos D√≠az",
        "team": "√Åguilas FC"
      },
      "type": "red_card",
      "severity": "major",
      "reason": "Agresi√≥n f√≠sica",
      "applied_at": "2024-12-26T16:10:00Z"
    }
  ]
}
```

---

## üë• Gesti√≥n de Categor√≠as de Jugadores

### Obtener Informaci√≥n de Categor√≠a de Jugador

**Endpoint:** `GET /players/{player}/category`
**Auth:** Requerida

#### Path Parameters

- `player`: ID del jugador

#### Response (200 OK)

```json
{
  "success": true,
  "player": {
    "id": 1,
    "name": "Juan P√©rez",
    "age": 34,
    "gender": "male",
    "current_category": {
      "name": "Senior",
      "value": "senior",
      "color": "#1E40AF",
      "icon": "trophy",
      "age_range": "18-99"
    },
    "is_correct_category": true
  }
}
```

#### Explicaci√≥n

Este endpoint retorna:
- **Categor√≠a actual** del jugador con metadata visual (color, icono)
- **Edad del jugador** calculada autom√°ticamente desde fecha de nacimiento
- **is_correct_category**: `true` si el jugador est√° en la categor√≠a correcta seg√∫n su edad, `false` si deber√≠a cambiar

---

### Actualizar Categor√≠a de Jugador

**Endpoint:** `PUT /players/{player}/category`
**Auth:** Requerida
**Roles:** LeagueAdmin, SuperAdmin

#### Path Parameters

- `player`: ID del jugador

#### Request

```json
{
  "category": "sub_17",
  "reason": "Cambio por edad, cumpli√≥ 17 a√±os"
}
```

#### Validaci√≥n

- `category`: **requerido**, string, debe ser una categor√≠a v√°lida
  - Valores v√°lidos: `senior`, `junior`, `sub_21`, `sub_19`, `sub_17`, `sub_15`, `sub_13`, `sub_11`
- `reason`: **requerido**, string, max 500 caracteres, justificaci√≥n del cambio

#### Response (200 OK)

```json
{
  "success": true,
  "message": "Categor√≠a actualizada exitosamente",
  "player": {
    "id": 1,
    "name": "Juan P√©rez",
    "old_category": "senior",
    "new_category": "sub_17",
    "reason": "Cambio por edad, cumpli√≥ 17 a√±os"
  }
}
```

#### Errores

**422 Validation Error** - Categor√≠a inv√°lida o datos faltantes
```json
{
  "success": false,
  "message": "Datos de validaci√≥n incorrectos",
  "errors": {
    "category": ["La categor√≠a seleccionada es inv√°lida"],
    "reason": ["El campo reason es obligatorio"]
  }
}
```

**422 Same Category** - El jugador ya est√° en esa categor√≠a
```json
{
  "success": false,
  "message": "El jugador ya est√° asignado a esta categor√≠a"
}
```

**500 Internal Server Error** - Error al actualizar
```json
{
  "success": false,
  "message": "Error interno del servidor"
}
```

---

### Categor√≠as Disponibles

| Categor√≠a | Valor API | Rango de Edad |
|-----------|-----------|---------------|
| Senior | `senior` | 18+ a√±os |
| Junior | `junior` | 17-20 a√±os |
| Sub 21 | `sub_21` | Hasta 21 a√±os |
| Sub 19 | `sub_19` | Hasta 19 a√±os |
| Sub 17 | `sub_17` | Hasta 17 a√±os |
| Sub 15 | `sub_15` | Hasta 15 a√±os |
| Sub 13 | `sub_13` | Hasta 13 a√±os |
| Sub 11 | `sub_11` | Hasta 11 a√±os |

### Casos de Uso

#### 1. Verificar si un jugador necesita cambio de categor√≠a

```javascript
const response = await fetch(`https://volleypass.test/api/v1/players/${playerId}/category`, {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept': 'application/json'
  }
});

const { player } = await response.json();

if (!player.is_correct_category) {
  alert(`‚ö†Ô∏è ${player.name} deber√≠a estar en otra categor√≠a seg√∫n su edad`);
}
```

#### 2. Actualizar categor√≠a de un jugador

```javascript
const response = await fetch(`https://volleypass.test/api/v1/players/${playerId}/category`, {
  method: 'PUT',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  },
  body: JSON.stringify({
    category: 'sub_17',
    reason: 'Cambio autom√°tico por edad cumplida'
  })
});

const result = await response.json();

if (result.success) {
  console.log(`‚úÖ Categor√≠a actualizada: ${result.player.old_category} ‚Üí ${result.player.new_category}`);
}
```

#### 3. Auditor√≠a de cambios

Cada cambio de categor√≠a se registra autom√°ticamente con:
- Usuario que realiz√≥ el cambio
- Fecha y hora del cambio
- Categor√≠a anterior y nueva
- Raz√≥n del cambio

Esta informaci√≥n queda almacenada en los logs del sistema para auditor√≠a.

---

## üìä Reportes y Administraci√≥n

### Reportes de Verificaciones

**Endpoint:** `GET /reports/verifications`
**Auth:** Requerida
**Roles:** LeagueAdmin, SuperAdmin
**Query Params:** `days` (default: 7)

#### Response (200 OK)

```json
{
  "data": [
    {
      "date": "2024-12-26",
      "total_verifications": 150,
      "successful": 145,
      "failed": 5,
      "avg_response_time": 142
    },
    {
      "date": "2024-12-25",
      "total_verifications": 120,
      "successful": 118,
      "failed": 2,
      "avg_response_time": 138
    }
  ]
}
```

---

### Resumen Diario

**Endpoint:** `GET /reports/daily-summary`
**Auth:** Requerida
**Roles:** LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "today": {
    "verifications": 125,
    "unique_players": 85,
    "active_verifiers": 12
  },
  "yesterday": {
    "verifications": 110,
    "unique_players": 78,
    "active_verifiers": 10
  }
}
```

---

### Eventos Activos

**Endpoint:** `GET /events/active`
**Auth:** Requerida
**Roles:** LeagueAdmin, SuperAdmin

#### Response (200 OK)

```json
{
  "events": [
    {
      "id": 1,
      "event_name": "Torneo Final",
      "event_type": "match",
      "venue": "Estadio Nacional",
      "event_date": "2024-12-26",
      "verifier": {
        "id": 1,
        "name": "Juan P√©rez"
      },
      "status": "in_progress",
      "verification_started_at": "2024-12-26T15:00:00Z",
      "total_verifications": 20
    }
  ]
}
```

---

### Limpiar Cache del Sistema

**Endpoint:** `POST /system/cache/clear`
**Auth:** Requerida
**Roles:** SuperAdmin

#### Response (200 OK)

```json
{
  "message": "Cache limpiado"
}
```

---

### Obtener Informaci√≥n del Sistema

**Endpoint:** `GET /system/info`
**Auth:** Requerida
**Roles:** SuperAdmin

#### Response (200 OK)

```json
{
  "php_version": "8.4.14",
  "laravel_version": "12.24.0",
  "environment": "production",
  "debug": false,
  "timezone": "America/Bogota",
  "database": {
    "connection": "mysql",
    "users_count": 450,
    "players_count": 400,
    "clubs_count": 15
  }
}
```

---

## üì° Broadcasting

### Autenticaci√≥n para Broadcasting

**Endpoint:** `POST /broadcasting/auth`
**Auth:** Requerida (Sanctum)

#### Response

Retorna token de autenticaci√≥n para Pusher/Socket.IO compatible con Laravel Broadcasting.

---

## üîî Webhooks

### Webhook: Cambio de Estado de Carnet

**Endpoint:** `POST /webhooks/card-status-changed`
**Auth:** No requerida (validar signature)

#### Payload

```json
{
  "event": "card.status.changed",
  "card_id": 1,
  "old_status": "active",
  "new_status": "suspended",
  "reason": "Falta de pago",
  "timestamp": "2024-12-26T15:45:00Z"
}
```

---

### Webhook: Alerta M√©dica

**Endpoint:** `POST /webhooks/medical-alert`
**Auth:** No requerida (validar signature)

#### Payload

```json
{
  "event": "medical.alert",
  "player_id": 1,
  "alert_type": "expired_certificate",
  "message": "Certificado m√©dico expirado",
  "timestamp": "2024-12-26T15:45:00Z"
}
```

---

## ‚ùå Manejo de Errores

### Formato Est√°ndar de Error

Todas las respuestas de error siguen este formato:

```json
{
  "success": false,
  "message": "Descripci√≥n del error",
  "error": "Detalles t√©cnicos (opcional)",
  "errors": {
    "campo": ["Error 1", "Error 2"]
  }
}
```

### C√≥digos de Estado HTTP

| C√≥digo | Significado | Uso |
|--------|-------------|-----|
| 200 | OK | Operaci√≥n exitosa |
| 201 | Created | Recurso creado |
| 400 | Bad Request | Request malformado |
| 401 | Unauthorized | No autenticado |
| 403 | Forbidden | Sin permisos |
| 404 | Not Found | Recurso no encontrado |
| 422 | Unprocessable Entity | Error de validaci√≥n |
| 429 | Too Many Requests | Rate limit excedido |
| 500 | Internal Server Error | Error del servidor |

### Ejemplos de Errores

#### 401 Unauthorized

```json
{
  "error": "Unauthenticated"
}
```

#### 403 Forbidden

```json
{
  "error": "Sin permisos"
}
```

#### 404 Not Found

```json
{
  "success": false,
  "message": "Recurso no encontrado",
  "error": "No se encontr√≥ el carnet con ID 999"
}
```

#### 422 Validation Error

```json
{
  "message": "The given data was invalid.",
  "errors": {
    "email": [
      "El email es requerido",
      "El email debe ser v√°lido"
    ],
    "password": [
      "La contrase√±a debe tener m√≠nimo 8 caracteres"
    ]
  }
}
```

#### 429 Too Many Requests

```json
{
  "error": "Demasiados intentos de login. Intente en 300 segundos."
}
```

#### 500 Internal Server Error

```json
{
  "success": false,
  "message": "Error interno del servidor",
  "error": "Database connection failed"
}
```

---

## üìê Formatos y Convenciones

### Headers Requeridos

```http
Accept: application/json
Content-Type: application/json
Authorization: Bearer {token}
X-App-Version: 1.0.0 (opcional)
```

### Formato de Fechas

Todas las fechas usan **ISO 8601**:

```
2024-12-26T15:45:00Z
```

### Paginaci√≥n

Todos los endpoints paginados retornan:

```json
{
  "current_page": 1,
  "data": [...],
  "per_page": 20,
  "total": 150,
  "last_page": 8,
  "from": 1,
  "to": 20
}
```

### Enumeraciones (Enums)

#### EventType
- `match` - Partido
- `tournament` - Torneo
- `training` - Entrenamiento

#### MatchStatus
- `scheduled` - Programado
- `in_progress` - En progreso
- `finished` - Finalizado
- `cancelled` - Cancelado

#### SanctionType
- `yellow_card` - Tarjeta amarilla
- `red_card` - Tarjeta roja
- `suspension` - Suspensi√≥n
- `fine` - Multa
- `warning` - Advertencia

#### SanctionSeverity
- `minor` - Menor
- `moderate` - Moderado
- `major` - Mayor
- `severe` - Severo

#### VerificationResult
- `success` - √âxito
- `warning` - Advertencia
- `error` - Error
- `not_found` - No encontrado

#### PlayerPosition
- `Setter` - Colocador
- `Opposite` - Opuesto
- `Middle_Blocker` - Central
- `Outside_Hitter` - Punta receptor
- `Libero` - L√≠bero

#### PlayerCategory
- `Senior` - Senior
- `Junior` - Junior
- `Sub_17` - Sub 17
- `Sub_15` - Sub 15
- `Sub_13` - Sub 13

---

## üöÄ Gu√≠a de Implementaci√≥n

### 1. Autenticaci√≥n en la App M√≥vil

```javascript
// Login
const loginResponse = await fetch('https://volleypass.test/api/v1/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  },
  body: JSON.stringify({
    email: 'verificador@volleypass.com',
    password: 'password123',
    device_name: 'iPhone 15 Pro'
  })
});

const { token, user } = await loginResponse.json();

// Guardar token en AsyncStorage/SecureStore
await AsyncStorage.setItem('auth_token', token);
await AsyncStorage.setItem('user', JSON.stringify(user));
```

### 2. Realizar Requests Autenticados

```javascript
// Obtener token almacenado
const token = await AsyncStorage.getItem('auth_token');

// Request autenticado
const response = await fetch('https://volleypass.test/api/v1/users/profile', {
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Authorization': `Bearer ${token}`
  }
});

const profile = await response.json();
```

### 3. Verificaci√≥n QR

```javascript
// Escanear QR y verificar
const qrCode = scannedQRCode; // Desde scanner

const verifyResponse = await fetch('https://volleypass.test/api/v1/mobile/verify', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    qr_code: qrCode,
    match_session_id: currentSessionId,
    device_info: 'iPhone 15 Pro - iOS 17.2',
    location: {
      latitude: 4.6097,
      longitude: -74.0817
    }
  })
});

const { success, verification, player } = await verifyResponse.json();

if (success && verification.result === 'eligible') {
  // Jugador puede jugar
  console.log(`‚úÖ ${player.full_name} - APTO`);
} else {
  // Jugador no puede jugar
  console.log(`‚ùå ${player.full_name} - NO APTO`);
}
```

### 4. Manejo de Errores

```javascript
const response = await fetch(url, options);

if (!response.ok) {
  const error = await response.json();

  switch (response.status) {
    case 401:
      // Token expirado, redirigir a login
      await AsyncStorage.removeItem('auth_token');
      navigation.navigate('Login');
      break;

    case 422:
      // Error de validaci√≥n
      console.error('Validation errors:', error.errors);
      break;

    case 429:
      // Rate limit excedido
      Alert.alert('Demasiadas solicitudes', 'Intente nuevamente en unos minutos');
      break;

    default:
      Alert.alert('Error', error.message || 'Ha ocurrido un error');
  }
}
```

### 5. Sincronizaci√≥n Offline

```javascript
// Guardar verificaci√≥n offline
const offlineVerifications = JSON.parse(
  await AsyncStorage.getItem('offline_verifications') || '[]'
);

offlineVerifications.push({
  qr_code: qrCode,
  verified_at: new Date().toISOString(),
  match_session_id: sessionId,
  device_info: deviceInfo
});

await AsyncStorage.setItem(
  'offline_verifications',
  JSON.stringify(offlineVerifications)
);

// Sincronizar cuando hay conexi√≥n
if (isOnline) {
  const syncResponse = await fetch('https://volleypass.test/api/v1/mobile/verifications/sync', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      verifications: offlineVerifications
    })
  });

  const { synced, failed } = await syncResponse.json();

  console.log(`‚úÖ Sincronizadas: ${synced}, ‚ùå Fallidas: ${failed}`);

  // Limpiar verificaciones sincronizadas
  await AsyncStorage.removeItem('offline_verifications');
}
```

### 6. WebSocket para Partidos en Vivo

```javascript
import Echo from 'laravel-echo';
import Pusher from 'pusher-js/react-native';

// Configurar Laravel Echo
const echo = new Echo({
  broadcaster: 'pusher',
  key: process.env.PUSHER_APP_KEY,
  cluster: process.env.PUSHER_APP_CLUSTER,
  forceTLS: true,
  authEndpoint: 'https://volleypass.test/api/v1/broadcasting/auth',
  auth: {
    headers: {
      Authorization: `Bearer ${token}`,
      Accept: 'application/json'
    }
  }
});

// Escuchar actualizaciones de partido
echo.channel(`match.${matchId}`)
  .listen('ScoreUpdated', (event) => {
    console.log('Nuevo marcador:', event.score);
    updateScore(event.score);
  })
  .listen('SetFinished', (event) => {
    console.log('Set finalizado:', event.set);
    showSetResult(event.set);
  });
```

---

## üìù Notas Importantes

### Rate Limiting

- **Login:** 5 intentos por 5 minutos por IP
- **Verificaci√≥n QR:** Sin l√≠mite (alto tr√°fico esperado)
- **API General:** 60 requests por minuto por usuario

### Seguridad

1. **Tokens:** Expiran en 30 d√≠as. Implementar refresh o re-login.
2. **QR Codes:** Deben ser SHA-256 (64 caracteres hex).
3. **HTTPS:** Todas las peticiones deben usar HTTPS en producci√≥n.
4. **Validaci√≥n:** Siempre validar datos en cliente Y servidor.

### Performance

1. **Paginaci√≥n:** Usar `per_page` para controlar tama√±o de respuestas.
2. **Caching:** Implementar cache local para datos est√°ticos (torneos, equipos).
3. **Offline First:** Permitir operaciones sin conexi√≥n con sincronizaci√≥n posterior.

### Testing

```bash
# Base URL de prueba
https://volleypass.test/api/v1

# Usuario de prueba
Email: verificador@volleypass.com
Password: password
```

---

## üìû Soporte

Para reportar bugs o solicitar nuevas funcionalidades, contactar al equipo de desarrollo.

---

**Fin de la Documentaci√≥n API de VolleyPass**

*Generado: Diciembre 26, 2024*
*Versi√≥n: 1.0.0*
